<%- include('../partials/header') %>

<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="/suppliers">Nhà cung cấp</a></li>
                <li class="breadcrumb-item active">Thêm mới</li>
            </ol>
        </nav>
        <h1 class="h2 mb-0">
            <i class="fas fa-plus-circle text-primary me-2"></i>
            Thêm nhà cung cấp mới
        </h1>
        <p class="text-muted">Điền thông tin chi tiết để thêm nhà cung cấp vào hệ thống</p>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Error Alert -->
        <% if (typeof error !== 'undefined') { %>
        <div class="alert alert-danger border-0 shadow-sm" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <div>
                    <strong>Lỗi!</strong> <%= error %>
                </div>
            </div>
        </div>
        <% } %>

        <!-- Main Form Card -->
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-primary text-white border-0">
                <h4 class="card-title mb-0">
                    <i class="fas fa-building me-2"></i>Thông tin nhà cung cấp
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="/suppliers" id="supplierForm" novalidate>
                    <div class="row">
                        <!-- Supplier Name -->
                        <div class="col-12 mb-4">
                            <label for="name" class="form-label">
                                <i class="fas fa-user text-primary me-1"></i>
                                Tên nhà cung cấp <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="text" 
                                class="form-control form-control-lg" 
                                id="name" 
                                name="name" 
                                value="<%= supplier.name || '' %>" 
                                placeholder="Nhập tên nhà cung cấp"
                                required
                                maxlength="100"
                            >
                            <div class="invalid-feedback">
                                Vui lòng nhập tên nhà cung cấp (tối đa 100 ký tự)
                            </div>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Tên sẽ được hiển thị trong danh sách và báo cáo
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="col-12 mb-4">
                            <label for="address" class="form-label">
                                <i class="fas fa-map-marker-alt text-success me-1"></i>
                                Địa chỉ <span class="text-danger">*</span>
                            </label>
                            <textarea 
                                class="form-control" 
                                id="address" 
                                name="address" 
                                rows="3" 
                                placeholder="Nhập địa chỉ đầy đủ"
                                required
                                maxlength="200"
                            ><%= supplier.address || '' %></textarea>
                            <div class="invalid-feedback">
                                Vui lòng nhập địa chỉ (tối đa 200 ký tự)
                            </div>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Bao gồm số nhà, tên đường, phường/xã, quận/huyện, tỉnh/thành phố
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="col-12 mb-4">
                            <label for="phone" class="form-label">
                                <i class="fas fa-phone text-info me-1"></i>
                                Số điện thoại <span class="text-danger">*</span>
                            </label>
                            <input 
                                type="tel" 
                                class="form-control form-control-lg" 
                                id="phone" 
                                name="phone" 
                                value="<%= supplier.phone || '' %>" 
                                placeholder="Nhập số điện thoại liên hệ"
                                required
                                pattern="[0-9+\-\s()]+"
                            >
                            <div class="invalid-feedback">
                                Vui lòng nhập số điện thoại hợp lệ
                            </div>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Ví dụ: 0123-456-789 hoặc +84-123-456-789
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="row">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                                <div class="text-muted">
                                    <i class="fas fa-shield-alt me-1"></i>
                                    Thông tin sẽ được mã hóa và bảo mật
                                </div>
                                <div class="btn-group">
                                    <a href="/suppliers" class="btn btn-secondary btn-lg">
                                        <i class="fas fa-arrow-left me-2"></i>Quay lại
                                    </a>
                                    <button type="reset" class="btn btn-outline-warning btn-lg">
                                        <i class="fas fa-undo me-2"></i>Đặt lại
                                    </button>
                                    <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                        <i class="fas fa-save me-2"></i>Lưu nhà cung cấp
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Help Card -->
        <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="fas fa-lightbulb text-warning me-2"></i>Gợi ý
                </h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Tên nên ngắn gọn và dễ nhớ
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Địa chỉ phải đầy đủ và chính xác
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Số điện thoại nên có mã vùng
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Kiểm tra thông tin trước khi lưu
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Form validation and enhancement
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('supplierForm');
    const submitBtn = document.getElementById('submitBtn');
    
    // Bootstrap validation
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        } else {
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Đang lưu...';
        }
        form.classList.add('was-validated');
    });

    // Real-time validation
    const inputs = form.querySelectorAll('input, textarea');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.checkValidity()) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            } else {
                this.classList.remove('is-valid');
                this.classList.add('is-invalid');
            }
        });

        input.addEventListener('input', function() {
            if (this.classList.contains('is-invalid') && this.checkValidity()) {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            }
        });
    });

    // Character counter for name field
    const nameInput = document.getElementById('name');
    const nameGroup = nameInput.closest('.mb-4');
    const nameCounter = document.createElement('div');
    nameCounter.className = 'text-muted small mt-1';
    nameGroup.appendChild(nameCounter);

    function updateNameCounter() {
        const remaining = 100 - nameInput.value.length;
        nameCounter.textContent = `${nameInput.value.length}/100 ký tự`;
        nameCounter.className = remaining < 20 ? 'text-warning small mt-1' : 'text-muted small mt-1';
    }
    
    nameInput.addEventListener('input', updateNameCounter);
    updateNameCounter();

    // Character counter for address field
    const addressInput = document.getElementById('address');
    const addressGroup = addressInput.closest('.mb-4');
    const addressCounter = document.createElement('div');
    addressCounter.className = 'text-muted small mt-1';
    addressGroup.appendChild(addressCounter);

    function updateAddressCounter() {
        const remaining = 200 - addressInput.value.length;
        addressCounter.textContent = `${addressInput.value.length}/200 ký tự`;
        addressCounter.className = remaining < 40 ? 'text-warning small mt-1' : 'text-muted small mt-1';
    }
    
    addressInput.addEventListener('input', updateAddressCounter);
    updateAddressCounter();

    // Phone formatting
    const phoneInput = document.getElementById('phone');
    phoneInput.addEventListener('input', function() {
        // Remove any non-numeric characters except +, -, spaces, and parentheses
        let value = this.value.replace(/[^0-9+\-\s()]/g, '');
        this.value = value;
    });
});
</script>

<%- include('../partials/footer') %>